GitHub Actions + EC2 + Systemd를 이용해 코드 푸시만 하면 자동으로 배포되는 백엔드 CI/CD 파이프라인을 구축한 과정을 정리했습니다.
# application-prod.yml 설정

외부 설정 파일은 jar 파일과 같은 위치에 있어야 Spring Boot가 자동으로 읽을 수 있습니다.
/opt/\<serviername>/config 에 아래 yml 파일을 넣어줍니다.
```yaml
spring: 
	datasource: 
		url: jdbc:mysql://<RDS-ENDPOINT>:3306/betterlife 
		username: admin 
		password: <RDS_PASSWORD> 
		driver-class-name: com.mysql.cj.jdbc.Driver 
	jpa: 
		hibernate: 
			ddl-auto: update 
		properties: 
			hibernate: 
				format_sql: true 
server: 
	port: 8080 

jwt: 
	secret: <LONG_RANDOM_SECRET> 
	expiration: 360000 

logging: 
	level: 
		org.springframework.web: DEBUG
```

---
# Systemd 서비스 등록

`sudo vim /etc/systemd/system/backend.service` 로 systemd 서비스 등록을 시작합니다.

```bash
[Unit] 
Description=Backend Service 
After=network-online.target 

[Service] 
User=ubuntu 

# 💡 애플리케이션이 존재하는 위치 
WorkingDirectory=/opt/betterlife 

# 💡 Spring Boot 실행 명령 
ExecStart=/usr/bin/java -jar app.jar 

# 💡 정상 종료 코드 (Spring Boot는 SIGTERM=143) 
SuccessExitStatus=143 

# 💡 환경 변수 (배포 환경 지정)
 Environment=SPRING_PROFILES_ACTIVE=prod 
 # 필요하면 여러 줄 추가 가능: 
 # Environment=SERVER_PORT=8080 
 # Environment=SPRING_DATASOURCE_URL=jdbc:mysql://... 
 
 # 💡 로그는 journalctl에서 자동 관리됨 
 StandardOutput=journal 
 StandardError=journal 
 
 # 💡 프로세스 다운 시 자동 재시작 
 Restart=always 
 RestartSec=5 
 
 [Install] 
 WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload 
sudo systemctl enable backend 
sudo systemctl start backend
```

여기까지 하면 서버 쪽 준비는 완료되었습니다.

---
# GitHub Actions 설정
프로젝트 폴더에 `.github/workflows/deploy.yml` 을 생성합니다.

```yml
name: Deploy Spring Boot to EC2  
  
on:  
  push:  
    branches: [ main ]  
  
jobs:  
  deploy:  
    runs-on: ubuntu-latest  
  
    steps:  
      - name: Checkout Repository  
        uses: actions/checkout@v4  
  
      - name: Set up JDK 23  
        uses: actions/setup-java@v4  
        with:  
          java-version: '23'  
          distribution: 'temurin'  
  
      - name: Build with Gradle  
        run: ./gradlew clean build -x test  
  
      - name: Upload jar to EC2  
        uses: appleboy/scp-action@v0.1.7  
        with:  
          host: ${{ secrets.EC2_HOST }}  
          username: ${{ secrets.EC2_USER }}  
          key: ${{ secrets.EC2_KEY }}  
          source: "build/libs/*.jar"  
          target: "/home/${{ secrets.EC2_USER }}/deploy/"  
          strip_components: 2  
          overwrite: true  
  
      - name: Deploy and restart service on EC2  
        uses: appleboy/ssh-action@v1.0.3  
        with:  
          host: ${{ secrets.EC2_HOST }}  
          username: ${{ secrets.EC2_USER }}  
          key: ${{ secrets.EC2_KEY }}  
          script: |  
            set -e  
  
            DEPLOY_DIR="/home/${{ secrets.EC2_USER }}/deploy"  
            APP_DIR="/opt/betterlife"  
            SERVICE_NAME="betterlife.service"  
  
            echo "배포 디렉토리: $DEPLOY_DIR"  
            echo "서비스 디렉토리: $APP_DIR"  
  
            # 배포 폴더 확인  
            if [ ! -d "$DEPLOY_DIR" ]; then  
              echo "$DEPLOY_DIR 폴더가 없습니다. 생성합니다..."  
              mkdir -p $DEPLOY_DIR  
            fi  
  
            # jar 파일 존재 확인  
            LATEST_JAR=$(ls -t $DEPLOY_DIR/*.jar 2>/dev/null | head -n 1 || true)  
            if [ -z "$LATEST_JAR" ]; then  
              echo "ERROR: $DEPLOY_DIR 안에 jar 파일이 없습니다!"  
              exit 1  
            fi  
  
            echo "배포할 파일: $LATEST_JAR"  
  
            # 기존 실행 중인 서비스 중지  
            echo "기존 서비스 중지 중..."  
            sudo systemctl stop $SERVICE_NAME || true  
  
            # 운영 폴더 준비  
            sudo mkdir -p $APP_DIR  
            sudo chown -R $USER:$USER $APP_DIR  
  
            # 새 파일 복사  
            echo "파일 교체 중..."  
            sudo cp "$LATEST_JAR" $APP_DIR/app.jar  
  
            # systemd 서비스 리로드 및 재시작  
            echo "서비스 재시작 중..."  
            sudo systemctl daemon-reload  
            sudo systemctl restart $SERVICE_NAME  
  
            # 서비스 상태 확인  
            sleep 3  
            STATUS=$(sudo systemctl is-active $SERVICE_NAME)  
            if [ "$STATUS" = "active" ]; then  
              echo "서비스가 정상적으로 실행 중입니다!"  
            else  
              echo "ERROR: 서비스 실행 실패. 로그 확인 필요."  
              sudo journalctl -u $SERVICE_NAME -n 30 --no-pager  
              exit 1  
            fi
```

여기서 secrets.XX 는 전부 깃허브 시크릿입니다.
깃허브 시크릿은 조금 더 보안이 잘 되어 있어서, 민감한 정보들은 여기에 넣어서 환경변수화 하는 것입니다.
깃허브 → Repository → Settings → Secrets → Actions로 들어가면 됩니다.
EC2_HOST 는 도메인 이름, EC2_KEY 는 접속하는 개인키, EC2_USER 는 보통 ubuntu 일 겁니다.

---
이렇게만 넣고 나면 코드 push 시에 자동으로 서버에 배포까지 해줍니다.